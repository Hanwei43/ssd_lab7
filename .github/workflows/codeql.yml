name: "CodeQL Analysis Lab"

on: [push, pull_request]

jobs:
  analyze:
    name: Analyze Code with CodeQL
    runs-on: ubuntu-latest

    permissions:
      actions: read
      contents: read

    strategy:
      fail-fast: false
      matrix:
        language: ['javascript']

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup CodeQL CLI
        uses: github/codeql-action/init@v3
        with:
          languages: ${{ matrix.language }}
          tools: latest

      - name: Build CodeQL database
        run: |
          codeql database create codeql-db \
            --language=${{ matrix.language }} \
            --command="npm install && npm run build || true"

      - name: Run CodeQL query suite
        run: |
          codeql database analyze codeql-db \
            --format=sarifv2.1.0 \
            --output=codeql-results.sarif \
            --rerun

      - name: Upload SARIF results as artifact (not to code scanning)
        uses: actions/upload-artifact@v4
        with:
          name: codeql-results
          path: codeql-results.sarif
